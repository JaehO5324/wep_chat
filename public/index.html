<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetch('/api/protected', {
      method: 'GET',
      credentials: 'include',
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Authentication failed');
        }
        return response.json();
      })
      .then((data) => {
        console.log('Authenticated user:', data.user);
      })
      .catch((err) => {
        console.error(err);
        window.location.href = '/login.html';
      });
  });

  const socket = io({
    auth: {
      token: document.cookie.split('token=')[1], // 쿠키에서 JWT 추출
    },
  });

  socket.on('load messages', (messages) => {
    messages.forEach((msg) => console.log(msg));
  });

  document.getElementById('send-button').addEventListener('click', () => {
    const message = document.getElementById('message-input').value;
    socket.emit('chat message', { message });
  });
</script>
